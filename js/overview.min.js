/* Developer: leo7044 (https://github.com/leo7044) */
var ObjectSessionVariables=null,ArraySeasonServerIds=null,ArrayDropDownListData=null,ArrayDropDownDefaultOwn=null,ObjectNeededMemberRoles={},ObjectPlayerData={},ObjectPlayerBaseData={},ObjectAlliancePlayerData={},ObjectAllianceData={},ObjectAllianceBaseData={},ObjectAllianceOverviewData={},ObjectBaseData={},ObjectWorldOverviewData={},ObjectDiagramData={},indexWorldId=0,ArrayAdminLog=null,ObjectCncOptPics={1:{build:{a:"bed291af87f3df1debd710bceb93339b",b:"7fffa929ca0e9638af471e7a253a48f0",c:"5425f9b3b2c406e1517d1bf3daaa1b80",d:"5030a7b96710ace8403d93bc4be3cb0a",e:"ff511429bde455769635de5c8c0331ba",f:"63c4221b2884a410478e42ae891c9edf",h:"",i:"8a1f3c4733a038c05390deb2efb254f7",n:"",p:"45ee74e3da3af2cb20d3fa8507dddd77",q:"068e7c9d022c4760d9c14b7caa26b31f",r:"96a293c753b08a31f29cdd75691330d3",s:"a222bf5074076084bb930a242423c324",t:"4bc5605149c6f6330630e31706b2975d",w:"6445fff4b183a735ca5028eeade06dca",x:"48d1286bac495eb7fb1cee71a3c1a172",y:"064f39ada6c95ed8a60c12c0ee53032d",z:"e1cb3016a04055a51378f6bbbee09c06"},def:{a:"c7747482bc35b977f4bc743f9f0e681f",b:"ac1a3216145582cb122ad0444305744a",c:"cc9b27f83c30256c4541f414d5a5eff9",d:"2efe3af60d7ad225a163338a13934eff",e:"ef3699386f7a1a8a189da12fde642bb5",f:"2ce93c21bf26af3eb040379291acfbe7",g:"004559af92de104d638c5e4187ab2f68",h:"d83af3ba4bd3c3cced272d16a714afeb",k:"b78f10062ea7d5e1b621165bc98f9aba",j:"7ecdf5416e6de57831e8e096e8445392",l:"af0f04fa7c5f45d7fe72cc14049c141f",m:"7ca2faeeb34e0bbe267ef985c5e7d47a",p:"af49b884f9b1bf86f6a74c6dba93f70e",q:"4c58dc7231d3db8bf162669b41471394",r:"bc9190a6a17aa8ea380ccf9c6d56270d",s:"c02ec23b12cdc627f2df0b50c7d1bcdd",t:"ac1a3216145582cb122ad0444305744a",w:"073528f52ec8cabaf5921a0d9a7da2eb",z:"0de460bca1916337a234fc05e9984b28"},off:{a:"3aec54985dcbf4b45ff84e1289d46a93",c:"9d0c409eb58a5fb8247cf6882fd31bfa",d:"fd4ffe3334d171c8d960d32fc9e05f80",f:"ecceb58e0ca3f150d85cb224bc345b9f",g:"004559af92de104d638c5e4187ab2f68",j:"aa4f4158569b0bd5255b1471f57a8a2c",k:"d96466153f645ba08707553b700869a2",m:"fe4e67d1d787bae0afb88625545f28a2",o:"42842f77387dbf0be9a0da05d09ea2e7",p:"3ca40f1ad54544ca6cc5b8053b09bfa3",q:"4c58dc7231d3db8bf162669b41471394",r:"b1c0d437f5be0deb9d8ec30d064596c5",s:"c02ec23b12cdc627f2df0b50c7d1bcdd",z:"0de460bca1916337a234fc05e9984b28"}},2:{build:{a:"fd45303e6de92356ff2631f0d89b18c6",b:"1f57aad9607fd714d869d56a2dd06f21",c:"5425f9b3b2c406e1517d1bf3daaa1b80",d:"68689144e5d27c3f5bd9be5078bebce8",e:"7b6edd4d58121a564fd702d152f89011",f:"4451b3a877eeee0e5b1c2a7a5d357b7e",h:"",i:"a46088f246aaedde74f7e6c0dd902a7a",n:"",p:"30c77e68b4e50d9633f969835afc84ec",q:"a0f7eaeb290b20f4dcba75289f9ee429",r:"6c8ee0f7603c621bbaef0e4b6563313e",s:"1ab36789d1dfbf749ddf7ffd9b013dbf",t:"4bc5605149c6f6330630e31706b2975d",w:"f6a0bb2a70d8b05e4cb4db827d9050a4",x:"370675edbcf691b67e1ae874e6efb783",y:"1124d44ed88596a9bf3025250665c218",z:"1f06c9c71a46c1902ff6a91dffed99e0"},def:{a:"97d5f7a66d9baa65453c2b142eeae3a4",b:"c45676344ea89bc56b291fe6216579a2",c:"5393c7f1282d25cba597e13ad634f1f7",d:"b97c04e08be8d479d54b3ca8262b0e2a",e:"5ee5c7b61f713dbde4602c998ed5e473",f:"53a600e31563975d611a7b5049fe9827",g:"ac5b7596bab3d1b919d7ec9d569f3cb4",h:"d83af3ba4bd3c3cced272d16a714afeb",k:"b78f10062ea7d5e1b621165bc98f9aba",j:"7ecdf5416e6de57831e8e096e8445392",l:"af0f04fa7c5f45d7fe72cc14049c141f",m:"d437cd22189d1c676c016de17170d2e9",p:"e022847fb155ce802c1e38a4cc627ee7",q:"939e53aef324e39bb0048b2c3dfb7988",r:"fb872bf7567447e2ca99eb27c67db685",s:"32eacc57fb7197ec96058a39c8d10aa2",t:"0c7e2d6bf5410cd368020bfb5106a84c",w:"7b144c4394665390eff687baad9bd01a",z:"1d76141c36ce7fb5d9b058481e5265fc"},off:{a:"88cf8ac7cfb2fdddb9f2acf70f22f1c1",b:"e022847fb155ce802c1e38a4cc627ee7",c:"e1e461f40c3611626243a516ac420fdf",k:"ac5b7596bab3d1b919d7ec9d569f3cb4",l:"c95af3da04ac7a0a490090498c90630d",m:"0a5ea3cdf78d1b773fd97e827b34376e",o:"b97c04e08be8d479d54b3ca8262b0e2a",p:"9910093e404ebf00259ac356609a0943",q:"939e53aef324e39bb0048b2c3dfb7988",r:"7836069122aac3e22c5b7fba07761274",s:"32eacc57fb7197ec96058a39c8d10aa2",t:"77316566179c7cab19bb6546f1389deb",v:"2a9522cbdb67b87d96443ec38ee0cdb9",z:"1d76141c36ce7fb5d9b058481e5265fc"}}};$(document).ready(function(){initializeStart(),setInterval(getLoginStatus,6e4)});function getLoginStatus(){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"getLoginStatus"}).always(function(a){a[0]||location.reload()}),$.ajaxSetup({async:!0})}function initializeStart(){getSessionVariables(),getSeasonServerIds(),getDropDownListData(),prepareandFillDropDownListDataWorld(),getCookie("TabId")?$("#"+getCookie("TabId")).click():setCookie("TabId","TabPlayer")}function getSessionVariables(){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"getSessionVariables"}).always(function(a){ObjectSessionVariables=a,ObjectSessionVariables.leoStats_IsAdmin&&$("#LiTabWorldOverview").removeClass("d-none")}),$.ajaxSetup({async:!0})}function getSeasonServerIds(){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"getSeasonServerIds"}).always(function(a){ArraySeasonServerIds=a}),$.ajaxSetup({async:!0})}function countLength(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b}String.prototype.toTimeFormat=function(){var a=parseInt(this),b=Math.floor(a/3600),c=(0 .toString()+Math.floor((a-3600*b)/60)).slice(-2),d=(0 .toString()+(a-3600*b-60*c)).slice(-2);return 10>b&&(b="0"+b),b+":"+c+":"+d},$(window).resize(function(){if($("#TabAlliance.active")[0])for(var a in ObjectDiagramData.Alliance)drawGoogleChartLine(ObjectDiagramData.Alliance[a][1],ObjectDiagramData.Alliance[a][0]);else if($("#TabBase.active")[0])for(var a in ObjectDiagramData.Base)drawGoogleChartLine(ObjectDiagramData.Base[a][1],ObjectDiagramData.Base[a][0]);else if($("#TabPlayer.active")[0])for(var a in ObjectDiagramData.Player)drawGoogleChartLine(ObjectDiagramData.Player[a][1],ObjectDiagramData.Player[a][0]);else if($("#TabAllianceOverview.active")[0])for(var a in ObjectDiagramData.OverviewAlliance)drawGoogleChartColumn(ObjectDiagramData.OverviewAlliance[a][1],ObjectDiagramData.OverviewAlliance[a][0]);else if($("#TabWorldOverview.active")[0])for(var a in ObjectDiagramData.OverviewWorld)drawGoogleChartColumn(ObjectDiagramData.OverviewWorld[a][1],ObjectDiagramData.OverviewWorld[a][0])});function getDropDownListData(){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"getDropDownListData"}).always(function(a){ArrayDropDownListData=a[0],ArrayDropDownDefaultOwn=a[1]}),$.ajaxSetup({async:!0})}function prepareandFillDropDownListDataWorld(){var a=alasql("SELECT DISTINCT WorldId, ServerName FROM ?",[ArrayDropDownListData]),b="";for(var c in a)b+="<option value=\""+a[c].WorldId+"\">"+a[c].ServerName+"</option>";$("#DropDownListWorld")[0].innerHTML=b,getCookie("WorldId")&&($("#DropDownListWorld")[0].value=getCookie("WorldId")),prepareandFillDropDownListDataAlliance()}function prepareandFillDropDownListDataAlliance(a){var b=$("#DropDownListWorld")[0].value;$("#TabBaseScanner")[0].href="BaseScanner/?WorldId="+b,setCookie("WorldId",b);var c=alasql("SELECT DISTINCT AllianceId, AllianceName FROM ? WHERE WorldId=\""+b+"\"",[ArrayDropDownListData]),d="";for(var e in c)d+="<option value=\""+c[e].AllianceId+"\">"+c[e].AllianceName+"</option>";$("#DropDownListAlliance")[0].innerHTML=d;var f=alasql("SELECT DISTINCT AllianceId FROM ? WHERE WorldId=\""+b+"\"",[ArrayDropDownDefaultOwn])[0];f&&($("#DropDownListAlliance")[0].value=f.AllianceId),a?prepareandFillDropDownListDataPlayer(a):(getCookie("AllianceId")&&($("#DropDownListAlliance")[0].value=getCookie("AllianceId")),prepareandFillDropDownListDataPlayer()),$("#TabWorldOverview.active")[0]&&manageContentWorldOverview()}function prepareandFillDropDownListDataPlayer(a){var b=$("#DropDownListWorld")[0].value,c=$("#DropDownListAlliance")[0].value;setCookie("AllianceId",c);var d=alasql("SELECT DISTINCT AccountId, UserName FROM ? WHERE WorldId=\""+b+"\" AND AllianceId=\""+c+"\"",[ArrayDropDownListData]),e="";for(var f in d)e+="<option value=\""+d[f].AccountId+"\">"+d[f].UserName+"</option>";$("#DropDownListPlayer")[0].innerHTML=e;var g=alasql("SELECT DISTINCT AccountId FROM ? WHERE WorldId=\""+b+"\" AND AllianceId=\""+c+"\"",[ArrayDropDownDefaultOwn])[0];g&&($("#DropDownListPlayer")[0].value=g.AccountId),a?(prepareandFillDropDownListDataBase(a),resetViewSettingsTabs()):(getCookie("AccountId")&&($("#DropDownListPlayer")[0].value=getCookie("AccountId")),prepareandFillDropDownListDataBase()),$("#TabAllianceMembers.active")[0]&&manageContentAllianceMembers(),$("#TabAlliance.active")[0]&&manageContentAlliance(),$("#TabAllianceBase.active")[0]&&manageContentAllianceBase(),$("#TabAllianceOverview.active")[0]&&manageContentAllianceOverview()}function prepareandFillDropDownListDataBase(a){var b=$("#DropDownListWorld")[0].value,c=$("#DropDownListAlliance")[0].value,d=$("#DropDownListPlayer")[0].value;setCookie("AccountId",d);var e=alasql("SELECT DISTINCT BaseId, Name FROM ? WHERE WorldId=\""+b+"\" AND AllianceId=\""+c+"\" AND AccountId=\""+d+"\"",[ArrayDropDownListData]),f="";for(var g in e)f+="<option value=\""+e[g].BaseId+"\">"+e[g].Name+"</option>";$("#DropDownListBase")[0].innerHTML=f,a?HelpFunctionForChangedBase(a):(getCookie("BaseId")&&($("#DropDownListBase")[0].value=getCookie("BaseId")),HelpFunctionForChangedBase()),$("#TabPlayer.active")[0]&&manageContentPlayer(),$("#TabPlayerBase.active")[0]&&manageContentPlayerBase(),$("#TabSettings.active")[0]&&manageContentSettings()}function HelpFunctionForChangedBase(){var a=$("#DropDownListBase")[0].value;setCookie("BaseId",a),$("#TabBase.active")[0]&&manageContentBase()}function changePlayerWithTableRowOnclick(a){$("#DropDownListPlayer")[0].value=a,$("#TabPlayerBase").click(),prepareandFillDropDownListDataBase(!0)}function changeBaseWithTableRowOnclick(a){$("#DropDownListBase")[0].value=a,$("#TabBase").click(),HelpFunctionForChangedBase()}function prepareTabPlayer(){$("#DivDropDownListAlliance").removeClass("d-none"),$("#DivDropDownListPlayer").removeClass("d-none"),$("#DivDropDownListBase").addClass("d-none"),manageContentPlayer(),setCookie("TabId","TabPlayer")}function prepareTabPlayerBase(){$("#DivDropDownListAlliance").removeClass("d-none"),$("#DivDropDownListPlayer").removeClass("d-none"),$("#DivDropDownListBase").addClass("d-none"),manageContentPlayerBase(),setCookie("TabId","TabPlayerBase")}function prepareTabAllianceMembers(){$("#DivDropDownListAlliance").removeClass("d-none"),$("#DivDropDownListPlayer").addClass("d-none"),$("#DivDropDownListBase").addClass("d-none"),manageContentAllianceMembers(),setCookie("TabId","TabAllianceMembers")}function prepareTabAlliance(){$("#DivDropDownListAlliance").removeClass("d-none"),$("#DivDropDownListPlayer").addClass("d-none"),$("#DivDropDownListBase").addClass("d-none"),manageContentAlliance(),setCookie("TabId","TabAlliance")}function prepareTabAllianceBase(){$("#DivDropDownListAlliance").removeClass("d-none"),$("#DivDropDownListPlayer").addClass("d-none"),$("#DivDropDownListBase").addClass("d-none"),manageContentAllianceBase(),setCookie("TabId","TabAllianceBase")}function prepareTabAllianceOverview(){$("#DivDropDownListAlliance").removeClass("d-none"),$("#DivDropDownListPlayer").addClass("d-none"),$("#DivDropDownListBase").addClass("d-none"),manageContentAllianceOverview(),setCookie("TabId","TabAllianceOverview")}function prepareTabBase(){$("#DivDropDownListAlliance").removeClass("d-none"),$("#DivDropDownListPlayer").removeClass("d-none"),$("#DivDropDownListBase").removeClass("d-none"),manageContentBase(),setCookie("TabId","TabBase")}function prepareTabWorldOverview(){$("#DivDropDownListAlliance").addClass("d-none"),$("#DivDropDownListPlayer").addClass("d-none"),$("#DivDropDownListBase").addClass("d-none"),manageContentWorldOverview(),setCookie("TabId","TabWorldOverview")}function prepareTabSettings(){$("#DivDropDownListAlliance").removeClass("d-none"),ObjectSessionVariables.leoStats_IsAdmin?$("#DivDropDownListPlayer").removeClass("d-none"):($("#DivDropDownListPlayer").addClass("d-none"),$("#DropDownListPlayer")[0].value=ObjectSessionVariables.leoStats_AccountId),$("#DivDropDownListBase").addClass("d-none"),manageContentSettings(),setCookie("TabId","TabSettings")}function updateCurrentDatasInView(){var a=$("#DropDownListWorld")[0].value,b=$("#DropDownListAlliance")[0].value,c=$("#DropDownListPlayer")[0].value,d=$("#DropDownListBase")[0].value;switch(getCookie("TabId")){case"TabPlayer":{delete ObjectPlayerData[a+"_"+c],manageContentPlayer();break}case"TabPlayerBase":{delete ObjectPlayerBaseData[a+"_"+c],manageContentPlayerBase();break}case"TabAllianceMembers":{delete ObjectAlliancePlayerData[a+"_"+b],manageContentAllianceMembers();break}case"TabAlliance":{delete ObjectAllianceData[a+"_"+b],manageContentAlliance();break}case"TabAllianceBase":{delete ObjectAllianceBaseData[a+"_"+b],manageContentAllianceBase();break}case"TabAllianceOverview":{delete ObjectAllianceOverviewData[a+"_"+b],manageContentAllianceOverview();break}case"TabBase":{delete ObjectBaseData[a+"_"+d],manageContentBase();break}case"TabWorldOverview":{delete ObjectWorldOverviewData[a.toString()],manageContentWorldOverview();break}default:}}function manageContentAllianceMembers(){var a=$("#DropDownListWorld")[0].value,b=$("#DropDownListAlliance")[0].value;if(!ObjectAlliancePlayerData[a+"_"+b]){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"getAlliancePlayerData",WorldId:a,AllianceId:b}).always(function(c){ObjectAlliancePlayerData[a+"_"+b]=c}),$.ajaxSetup({async:!0})}ObjectAlliancePlayerCur=ObjectAlliancePlayerData[a+"_"+b];var c="";for(var d in ObjectAlliancePlayerCur[0])"AccountId"!=d&&(c+="<th class=\"text-center\">"+d+"</th>");$("#TableAlliancePlayerTheadTr")[0].innerHTML||($("#TableAlliancePlayerTheadTr")[0].innerHTML=c),$("#TableAlliancePlayerTheadTr")[0].children[1].style.minWidth="64px";var e=[[],[]];c="";var f=["UserName","Zeit","LvLOff","LvLDef","BaseD","OffD","DefD","DFD","SupD"];for(var g in ObjectAlliancePlayerCur){for(var h in c+="<tr>",ObjectAlliancePlayerCur[g])"AccountId"==h?(e[0].push(ObjectAlliancePlayerCur[g][h]),e[1].push(ObjectAlliancePlayerCur[g].UserName),delete ObjectAlliancePlayerCur[g][h]):c+="RepMax"==h?"<td>"+ObjectAlliancePlayerCur[g][h].toTimeFormat()+"</td>":isNaN(parseInt(ObjectAlliancePlayerCur[g][h]))||-1!=f.indexOf(h)?"<td>"+ObjectAlliancePlayerCur[g][h]+"</td>":"<td>"+Intl.NumberFormat("en-US").format(parseInt(ObjectAlliancePlayerCur[g][h]))+"</td>";c+="</tr>"}var i=buildArrayTableBody("TableAlliancePlayer",ObjectAlliancePlayerCur,c);for(var g in resetDataTable("TableAlliancePlayer",i,e,!0),ObjectAlliancePlayerCur)ObjectAlliancePlayerCur[g].AccountId=e[0][g]}function manageContentAlliance(){var a=$("#DropDownListWorld")[0].value,b=$("#DropDownListAlliance")[0].value;if(!ObjectAllianceData[a+"_"+b]){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"getAllianceData",WorldId:a,AllianceId:b}).always(function(c){ObjectAllianceData[a+"_"+b]=c}),$.ajaxSetup({async:!0})}var c=ObjectAllianceData[a+"_"+b];ObjectDiagramData.Alliance={},ObjectDiagramData.Alliance.Score=[[],["Zeit","ScoreTib","ScoreCry","ScorePow","ScoreInf","ScoreVeh","ScoreAir","ScoreDef","AlliancePoints"]],ObjectDiagramData.Alliance.Rank=-1==ArraySeasonServerIds.indexOf(a)?[[],["Zeit","AllianceRank","RankTib","RankCry","RankPow","RankInf","RankVeh","RankAir","RankDef","AllianceRank"]]:[[],["Zeit","AllianceRank","EventRank","RankTib","RankCry","RankPow","RankInf","RankVeh","RankAir","RankDef","AllianceRank"]],ObjectDiagramData.Alliance.BonusRes=[[],["Zeit","BonusTiberium","BonusCrystal","BonusPower","AllianceBonus - Ressoucen"]],ObjectDiagramData.Alliance.BonusFight=[[],["Zeit","BonusInfantrie","BonusVehicle","BonusAir","BonusDef","AllianceBonus - Fight"]],drawDiagrams(c,"Alliance")}function manageContentAllianceBase(){var a=$("#DropDownListWorld")[0].value,b=$("#DropDownListAlliance")[0].value,c=$("#DropDownAllianceBaseType")[0].value;if(ObjectAllianceBaseData[a+"_"+b]||(ObjectAllianceBaseData[a+"_"+b]={}),!ObjectAllianceBaseData[a+"_"+b][c]){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"getAllianceBaseData",WorldId:a,AllianceId:b,type:c}).always(function(d){ObjectAllianceBaseData[a+"_"+b][c]=d}),$.ajaxSetup({async:!0})}var d=ObjectAllianceBaseData[a+"_"+b][c],e=0,f=0,g="",h=0;for(p in d)d[p].UserName!=g&&(f=0,h++),g=d[p].UserName,f++,f>e&&(e=f);for(var k="<th onclick=\"sortTable(0, 'TableAllianceBase', 'asc')\">PlayerName</th><th onclick=\"sortTable(1, 'TableAllianceBase', 'asc')\">Faction</th>",l=1;l<=e;l++)k+="<th style=\"text-align: center;\" onclick=\"sortTable("+(l+1)+", 'TableAllianceBase', 'desc')\">Base "+l+"</th>";$("#TableAllianceBaseTheadTr")[0].innerHTML=k,g="",f=1;for(var h=-1,l=0;l<d.length;l++)d[l][c]=parseFloat(d[l][c]);var m=alasql("SELECT MAX("+c+") FROM ?",[d])[0]["MAX("+c+")"],n=["#33CC33","#44CC33","#55CC33","#66CC33","#77CC33","#88CC33","#99CC33","#AACC33","#BBCC33","#CCCC33","#CCBB33","#CCAA33","#CC9933","#CC8833","#CC7733","#CC6633","#CC5533","#CC4433","#CC3333"],o="";for(var p in k="",d){if(d[p].UserName!=g)if(0!=p){for(h++;f<=e;)k+="<td></td>",f++;f=1,k+="</tr><tr><td>"+d[p].UserName+"</td><td style=\"text-align: center;\"><img src=\"img/faction_"+d[p].Faction+".png\" width=\"20px\" height=\"20px\"></td>"}else k+="<td>"+d[p].UserName+"</td><td style=\"text-align: center;\"><img src=\"img/faction_"+d[p].Faction+".png\" width=\"20px\" height=\"20px\"></td>";var q=parseFloat(d[p][c])/parseFloat(m);if(o=.99<=q?n[0]:.98<=q?n[1]:.97<=q?n[2]:.96<=q?n[3]:.95<=q?n[4]:.94<=q?n[5]:.93<=q?n[6]:.92<=q?n[7]:.91<=q?n[8]:.9<=q?n[9]:.8<=q?n[10]:.7<=q?n[11]:.6<=q?n[12]:.5<=q?n[13]:.4<=q?n[14]:.3<=q?n[15]:.2<=q?n[16]:.1<=q?n[17]:0<=q?n[18]:"",k+="<td style=\"text-align: right; background-color: "+o+"; cursor: pointer;\" onclick=\"convertCncOptToArray('"+d[p].CnCOpt+"', '"+d[p].UserName+"', "+f+");\">",k+="LvLOff"==c||"LvLDef"==c?Intl.NumberFormat("en-US",{minimumFractionDigits:2}).format(d[p][c])+"</td>":"LvLSup"==c?d[p][c]+"</td>":Intl.NumberFormat("en-US").format(d[p][c])+"</td>",g=d[p].UserName,f++,p==d.length-1)for(;f<=e;)k+="<td></td>",f++}k+="</tr>",$("#TableAllianceBaseTbody")[0].innerHTML=k}function manageContentPlayer(){var a=$("#DropDownListWorld")[0].value,b=$("#DropDownListPlayer")[0].value;if(!ObjectPlayerData[a+"_"+b]){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"getPlayerData",WorldId:a,AccountId:b}).always(function(c){ObjectPlayerData[a+"_"+b]=c}),$.ajaxSetup({async:!0})}var c=ObjectPlayerData[a+"_"+b];ObjectDiagramData.Player={},ObjectDiagramData.Player.ScorePoints=[[0],["Zeit","ScorePoints","AverageScore","Player - ScorePoints"]],ObjectDiagramData.Player.Rank=-1==ArraySeasonServerIds.indexOf(a)?[[0],["Zeit","OverallRank","Player - Ranking"]]:[[0],["Zeit","OverallRank","EventRank","Player - Ranking"]],ObjectDiagramData.Player.Production=[[0],["Zeit","GesamtTiberium","GesamtCrystal","GesamtPower","GesamtCredits","Player - Production"]],ObjectDiagramData.Player.RpsCred=[[0],["Zeit","ResearchPoints","Credits","Player - RPs / Credits"]],ObjectDiagramData.Player.Shoots=[[0],["Zeit","Shoot","PvP","PvE","Player - Shoots"]],ObjectDiagramData.Player.Values=[[0],["Zeit","BaseD","LvLOff","LvLDef","OffD","DefD","DFD","SupD","Player - Values"]],-1==ArraySeasonServerIds.indexOf(a)?(document.getElementById("GoogleChartLinePlayer - VPs").className="d-none",document.getElementById("GoogleChartLinePlayer - LPs").className="d-none"):(document.getElementById("GoogleChartLinePlayer - VPs").className="divGoogleChart",document.getElementById("GoogleChartLinePlayer - LPs").className="divGoogleChart",ObjectDiagramData.Player.Vps=[[0],["Zeit","VP","Player - VPs"]],ObjectDiagramData.Player.Lps=[[0],["Zeit","LP","Player - LPs"]]),ObjectDiagramData.Player.Cps=[[0],["Zeit","CPMax","CPCur","Player - CPs"]],ObjectDiagramData.Player.Funds=[[0],["Zeit","Funds","Player - Funds"]],drawDiagrams(c,"Player")}function manageContentPlayerBase(){var a=$("#DropDownListWorld")[0].value,b=$("#DropDownListPlayer")[0].value;if(!ObjectPlayerBaseData[a+"_"+b]){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"getPlayerBaseData",WorldId:a,AccountId:b}).always(function(c){ObjectPlayerBaseData[a+"_"+b]=c}),$.ajaxSetup({async:!0})}var c=ObjectPlayerBaseData[a+"_"+b],d="";for(var e in c[0])"BaseId"!=e&&(d+="<th class=\"text-center\">"+e+"</th>");$("#TablePlayerBaseTheadTr")[0].innerHTML||($("#TablePlayerBaseTheadTr")[0].innerHTML=d);var f=[[],[]];for(var g in d="",c){for(var h in d+="<tr id=\""+c[g].BaseId+"\">",c[g])"Rep"==h?d+="<td>"+c[g][h].toTimeFormat()+"</td>":"Tib"==h||"Cry"==h||"Pow"==h||"Cre"==h?d+="<td>"+Intl.NumberFormat("en-US").format(parseInt(c[g][h]))+"</td>":"CnCOpt"==h?d+="<td><a href=\""+c[g][h]+"\" target=\"_blank\">"+c[g].Name+"</a></td>":"BaseId"==h?(f[0].push(c[g][h]),f[1].push(c[g].Name),delete c[g][h]):d+="<td>"+c[g][h]+"</td>";d+="</tr>"}var i=buildArrayTableBody("TablePlayerBase",c,d);for(var g in resetDataTable("TablePlayerBase",i,f),c)c[g].BaseId=f[0][g]}function manageContentAllianceOverview(){var a=$("#DropDownListWorld")[0].value,b=$("#DropDownListAlliance")[0].value;if(!ObjectAllianceOverviewData[a+"_"+b]){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"getAllianceOverviewData",WorldId:a,AllianceId:b}).always(function(c){ObjectAllianceOverviewData[a+"_"+b]=c}),$.ajaxSetup({async:!0})}var c=ObjectAllianceOverviewData[a+"_"+b][0],d=ObjectAllianceOverviewData[a+"_"+b][1],e=ObjectAllianceOverviewData[a+"_"+b][2];createOverviews(c,"OverviewAlliance","Alliance","Offense"),createOverviews(d,"OverviewAlliance","Alliance","Defense"),createOverviews(e,"OverviewAlliance","Alliance","Support"),drawOverviews("OverviewAlliance")}function manageContentBase(){var a=$("#DropDownListWorld")[0].value,b=$("#DropDownListBase")[0].value;if(!ObjectBaseData[a+"_"+b]){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"getBaseData",WorldId:a,BaseId:b}).always(function(c){ObjectBaseData[a+"_"+b]=c}),$.ajaxSetup({async:!0})}var c=ObjectBaseData[a+"_"+b];ObjectDiagramData.Base={},ObjectDiagramData.Base.Production=[[],["Zeit","Tib","Cry","Pow","Cre","Base - Production"]],ObjectDiagramData.Base.Values=[[],["Zeit","LvLCY","LvLBase","LvLOff","LvLDef","LvLDF","LvLSup","Base - Values"]],ObjectDiagramData.Base.RepairTime=[[],["Zeit","Rep","RepMax","Base - RepairTime"]];var d=[];for(var e in c)d[e]=[],d[e][0]=c[e].Rep,d[e][1]=c[e].RepMax,c[e].Rep/=3600,c[e].RepMax/=3600;for(var e in drawDiagrams(c,"Base"),c)c[e].Rep=d[e][0],c[e].RepMax=d[e][1];$("#LinkCncOpt")[0].href=c[countLength(c)-1].CnCOpt}function manageContentWorldOverview(){var a=$("#DropDownListWorld")[0].value;if(!ObjectWorldOverviewData[a.toString()]){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"getWorldOverviewData",WorldId:a}).always(function(b){ObjectWorldOverviewData[a.toString()]=b}),$.ajaxSetup({async:!0})}var b=ObjectWorldOverviewData[a.toString()][0],c=ObjectWorldOverviewData[a.toString()][1],d=ObjectWorldOverviewData[a.toString()][2];createOverviews(b,"OverviewWorld","World","Offense"),createOverviews(c,"OverviewWorld","World","Defense"),createOverviews(d,"OverviewWorld","World","Support"),drawOverviews("OverviewWorld")}function manageContentSettings(){if(!ObjectSessionVariables.leoStats_IsAdmin)for(var a=0;a<ArrayDropDownDefaultOwn.length;a++)if(ArrayDropDownDefaultOwn[a].WorldId==$("#DropDownListWorld")[0].value){indexWorldId=a;break}ObjectSessionVariables.leoStats_IsAdmin?($("#v-pills-alliance-tab").removeClass("d-none"),$("#v-pills-server-tab").removeClass("d-none"),$("#AdminButtonsPlayer").removeClass("d-none")):1==ArrayDropDownDefaultOwn[indexWorldId].MemberRole?$("#v-pills-alliance-tab").removeClass("d-none"):$("#v-pills-alliance-tab").addClass("d-none"),resetFormChangePassword(!0)}function resetViewSettingsTabs(){$("#v-pills-player-tab").addClass("active show"),$("#v-pills-alliance-tab").removeClass("active show"),$("#v-pills-server-tab").removeClass("active show"),$("#v-pills-player").addClass("active show"),$("#v-pills-alliance").removeClass("active show"),$("#v-pills-server").removeClass("active show")}function changePassword(){var a=ObjectSessionVariables.leoStats_AccountId,b="action=changePassword&AccountId="+a+"&"+$("#FormChangePassword").serialize();return $.ajaxSetup({async:!1}),$.post("php/manageBackend.php",b).always(function(a){a[0]?($("#PasswordChangeFail").addClass("d-none"),$("#PasswordChangeSuccess").removeClass("d-none"),resetFormChangePassword()):($("#PasswordChangeFail").removeClass("d-none"),$("#PasswordChangeSuccess").addClass("d-none"))}),$.ajaxSetup({async:!0}),!1}function resetFormChangePassword(a){document.forms.FormChangePassword.reset(),a&&($("#PasswordChangeFail").addClass("d-none"),$("#PasswordChangeSuccess").addClass("d-none")),$("#InputUserName")[0].value=$("#DropDownListPlayer")[0][$("#DropDownListPlayer")[0].selectedIndex].innerHTML}function validatePassword(){$("#InputNewPassword")[0].value==$("#InputConfirmNewPassword")[0].value?$("#InputConfirmNewPassword")[0].setCustomValidity(""):$("#InputConfirmNewPassword")[0].setCustomValidity("Passwords do not match")}function resetPlayer(){var a=$("#DropDownListPlayer")[0][$("#DropDownListPlayer")[0].selectedIndex].innerHTML;if(confirm("Do you want reset player "+a+"?")){var b=$("#DropDownListPlayer")[0].value;$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"resetPlayer",Id:b,PlayerName:a}),$.ajaxSetup({async:!0})}}function deletePlayer(){var a=$("#DropDownListPlayer")[0][$("#DropDownListPlayer")[0].selectedIndex].innerHTML;if(confirm("Do you want to delete player "+a+" from database?")){var b=$("#DropDownListPlayer")[0].value;$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"deletePlayer",Id:b}),$.ajaxSetup({async:!0}),initializeStart()}}function prepareSettingsAlliance(){if(ObjectSessionVariables.leoStats_IsAdmin){var a=$("#DropDownListWorld")[0].value,b=$("#DropDownListAlliance")[0].value;getNeededMemberRoles(a,b),$("#DropDownListMemberRole")[0].selectedIndex=ObjectNeededMemberRoles[a+"_"+b].MemberRole-1}else $("#DropDownListMemberRole")[0].selectedIndex=ArrayDropDownDefaultOwn[indexWorldId].NeededMemberRole-1;for(var c="<tr>",d=0;d<$("#DropDownListPlayer")[0].length;d++)c+="<td id=\"TableCell_"+$("#DropDownListPlayer")[0].options[d].value+"\"><span id=\"TableCellName_"+$("#DropDownListPlayer")[0].options[d].value+"\">"+$("#DropDownListPlayer")[0].options[d].innerHTML+"</span><button class=\"btn btn-light float-right\" onclick=\"deletePlayerTableCell('TableCell_"+$("#DropDownListPlayer")[0].options[d].value+"');\"><font color=\"#FF0000;\"><i class=\"fas fa-times\"></i></font></button></td>",(d+1)%5||(c+="</tr><tr>");c+="</tr>",$("#TableSettingsAlliancePlayerTBody")[0].innerHTML=c,$("#MemberRoleChangeFail").addClass("d-none"),$("#MemberRoleChangeSuccess").addClass("d-none")}function prepareSettingsServer(){$("#TableAdminLog").DataTable().destroy(),getAdminLog(),prepareAdminLogTable()}function saveChangeNeededMemberRole(){var a=$("#DropDownListWorld")[0].value,b=$("#DropDownListAlliance")[0].value,c=$("#DropDownListMemberRole")[0].value;$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"changeNeededMemberRole",WorldId:a,AllianceId:b,MemberRole:c}).always(function(c){c[0]?($("#MemberRoleChangeFail").addClass("d-none"),$("#MemberRoleChangeSuccess").removeClass("d-none"),ObjectSessionVariables.leoStats_IsAdmin?ObjectNeededMemberRoles[a+"_"+b].MemberRole=$("#DropDownListMemberRole")[0].selectedIndex+1:ArrayDropDownDefaultOwn[indexWorldId].NeededMemberRole=$("#DropDownListMemberRole")[0].value):($("#MemberRoleChangeFail").removeClass("d-none"),$("#MemberRoleChangeSuccess").addClass("d-none"))}),$.ajaxSetup({async:!0})}function getNeededMemberRoles(a,b){if(!ObjectNeededMemberRoles[a+"_"+b]){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"getNeededMemberRoles",WorldId:a,AllianceId:b}).always(function(c){ObjectNeededMemberRoles[a+"_"+b]=c}),$.ajaxSetup({async:!0})}}function deletePlayerTableCell(a){var b=a.substr(10,a.length-10),c=$("#TableCellName_"+b)[0].innerHTML;if(confirm("Do you want to remove "+c+" from alliance?")){var d=$("#DropDownListWorld")[0].value,e=$("#DropDownListAlliance")[0].value;$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"deletePlayerFromAlliance",WorldId:d,AllianceId:e,AccountId:b}),$.ajaxSetup({async:!0}),initializeStart(),prepareSettingsAlliance()}}function optimizeAllTables(){$("#LoadingSymbol").removeClass("d-none"),setTimeout(function(){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"optimizeAllTables"}),$.ajaxSetup({async:!0}),$("#LoadingSymbol").addClass("d-none")},50)}function deleteServer(){var a=$("#DropDownListWorld")[0][$("#DropDownListWorld")[0].selectedIndex].innerHTML;if(confirm("Do you want to delete server "+a+" from database?")){var b=$("#DropDownListWorld")[0].value;$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"deleteServer",Id:b}),$.ajaxSetup({async:!0}),initializeStart()}}function getAdminLog(){$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"getAdminLog"}).always(function(a){ArrayAdminLog=a}),$.ajaxSetup({async:!0})}function prepareAdminLogTable(){var a="";for(var b in ArrayAdminLog)ArrayAdminLog[b].Delete="<button class=\"btn btn-light float-right\" onclick=\"deleteElementAdminLog('"+ArrayAdminLog[b].Id+"')\"><font color=\"#FF0000;\"><i class=\"fas fa-times\"></i></font></button>",a+="<tr><td>"+ArrayAdminLog[b].Id+"</td><td>"+ArrayAdminLog[b].Zeit+"</td><td>"+ArrayAdminLog[b].Initiator+"</td><td>"+ArrayAdminLog[b].Description+"</td><td>"+ArrayAdminLog[b].Delete+"</td></tr>";$("#TableAdminLogTbody")[0].innerHTML=a,$("#TableAdminLog").DataTable({order:[[0,"desc"]]})}function deleteElementAdminLog(a){$("#TableAdminLog").DataTable().destroy();$.ajaxSetup({async:!1}),$.post("php/manageBackend.php",{action:"deleteElementAdminLog",Id:a}),$.ajaxSetup({async:!0}),getAdminLog(),prepareAdminLogTable()}function buildArrayTableBody(a,b,c){$("#"+a+"Tbody")[0].innerHTML=c;for(var d,e=[],f=0;f<countLength(b);f++){d=[];for(var g=0;g<countLength(b[f]);g++)d.push($("#"+a+"Tbody")[0].children[f].children[g].innerHTML);e.push(d)}return e}function resetDataTable(a,b,c,d){$("#"+a+".dataTable")[0]||(d?$("#"+a).DataTable({paging:!1,order:[[0,"asc"]]}):$("#"+a).DataTable({paging:!1,order:[[1]]}),$(".dataTables_info").parents()[1].remove(),$("#"+a+"_wrapper").children()[1].style["overflow-x"]="auto","TablePlayerBase"==a?$("#TablePlayerBase_filter")[0].children[0].children[0].onkeyup=function(){prepareTabPlayerBase()}:"TableAlliancePlayer"==a&&($("#TableAlliancePlayer_filter")[0].children[0].children[0].onkeyup=function(){prepareTabPlayer()})),$("#"+a).DataTable().clear(),$("#"+a).DataTable().rows.add(b),$("#"+a).DataTable().draw();for(var e=0;e<$("#"+a+"Tbody")[0].children.length;e++){if("TablePlayerBase"==a)for(var f=1;f<$("#"+a+"Tbody")[0].children[e].children.length-1;f++)$($("#"+a+"Tbody")[0].children[e].children[f]).addClass("text-right");else if("TableAlliancePlayer"==a)for(var f=1;f<$("#"+a+"Tbody")[0].children[e].children.length;f++)$($("#"+a+"Tbody")[0].children[e].children[f]).addClass("text-right");var g=$("#"+a+"Tbody")[0].children[e].children[0].innerHTML,h=c[1].indexOf(g);$("#"+a+"Tbody")[0].children[e].id=c[0][h],$("#"+a+"Tbody")[0].children[e].style.cursor="pointer","TablePlayerBase"==a?$("#"+a+"Tbody")[0].children[e].onclick=function(a){changeBaseWithTableRowOnclick(a.path[1].id)}:"TableAlliancePlayer"==a&&($("#"+a+"Tbody")[0].children[e].onclick=function(a){changePlayerWithTableRowOnclick(a.path[1].id)})}}function drawDiagrams(a,b){for(var c in a)for(var d in ObjectDiagramData[b]){ObjectDiagramData[b][d][0][c]=[],ObjectDiagramData[b][d][0][c].push(a[c][ObjectDiagramData[b][d][1][0]]);for(var e=1;e<ObjectDiagramData[b][d][1].length-1;e++)ObjectDiagramData[b][d][0][c].push(parseInt(100*a[c][ObjectDiagramData[b][d][1][e]])/100)}setTimeout(function(){for(var a in ObjectDiagramData[b])drawGoogleChartLine(ObjectDiagramData[b][a][1],ObjectDiagramData[b][a][0])})}function createOverviews(a,b,c,d){ObjectDiagramData[b]||(ObjectDiagramData[b]={}),ObjectDiagramData[b][d]=[[],[]];for(var e=0;82>=e;e++)ObjectDiagramData[b][d][1].push(e);ObjectDiagramData[b][d][1].push(c+" - "+d);var e=j=0;for(var f in a)parseInt(a[f])&&(ObjectDiagramData[b][d][0][j]=[],ObjectDiagramData[b][d][0][j].push(parseInt(ObjectDiagramData[b][d][1][e])),ObjectDiagramData[b][d][0][j].push(parseInt(a[f])),ObjectDiagramData[b][d][0].push(ObjectDiagramData[b][d][0][j]),j++),e++;ObjectDiagramData[b][d][0].pop(),ObjectDiagramData[b][d][0].unshift(["Level","Count"])}function drawOverviews(a){setTimeout(function(){drawGoogleChartColumn(ObjectDiagramData[a].Offense[1],ObjectDiagramData[a].Offense[0]),drawGoogleChartColumn(ObjectDiagramData[a].Defense[1],ObjectDiagramData[a].Defense[0]),drawGoogleChartColumn(ObjectDiagramData[a].Support[1],ObjectDiagramData[a].Support[0])})}function drawGoogleChartLine(a,b){google.charts.load("current",{packages:["corechart","line"]}),google.charts.setOnLoadCallback(function(){var c=new google.visualization.DataTable;c.addColumn("string",a[d]);for(var d=1;d<a.length-1;d++)c.addColumn("number",a[d]);c.addRows(b);var e={title:a[a.length-1],hAxis:{title:"Datum"},vAxis:{title:a[a.length-1]}},f=new google.visualization.LineChart(document.getElementById("GoogleChartLine"+a[a.length-1]));f.draw(c,e)})}function drawGoogleChartColumn(a,b){google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback(function(){var c=google.visualization.arrayToDataTable(b),d=new google.visualization.DataView(c);d.setColumns([0,1]);var e={title:a[a.length-1]},f=new google.visualization.ColumnChart(document.getElementById("GoogleChartColumn"+a[a.length-1]));f.draw(d,e)})}function sortTable(a,b,c){var d,e,f,g,h,k,l,m,n=0;for(d=document.getElementById(b),f=!0,m=c;f;){for(f=!1,e=d.getElementsByTagName("tr"),g=1;g<e.length-1;g++)if(l=!1,h=e[g].getElementsByTagName("td")[a],k=e[g+1].getElementsByTagName("td")[a],!1==isNaN(parseInt(h.innerHTML))&&!1==isNaN(parseInt(k.innerHTML))){if("desc"==m){if(parseInt(h.innerHTML.replace(/,|\./g,""))<parseInt(k.innerHTML.replace(/,|\./g,""))){l=!0;break}}else if("asc"==m&&parseInt(h.innerHTML.replace(/,|\./g,""))>parseInt(k.innerHTML.replace(/,|\./g,""))){l=!0;break}}else if("desc"==m){if(h.innerHTML.toLowerCase()<k.innerHTML.toLowerCase()){l=!0;break}}else if("asc"==m&&h.innerHTML.toLowerCase()>k.innerHTML.toLowerCase()){l=!0;break}if(l)e[g].parentNode.insertBefore(e[g+1],e[g]),f=!0,n++;else if(0==n&&"desc"==m?(m="asc",f=!0):0==n&&"asc"==m&&(m="desc",f=!0),2==e.length)break}}function convertCncOptToArray(a,b,c){var d=a.split("|"),e=d[1];switch(e){case"G":{e=1;break}case"N":{e=2;break}default:{e=0;break}}var f=d[4],g=$.grep(f.replace(/\./g,"|.|").replace(/([a-z])/g,function(a){return a+"|"}).replace(/\|\|/g,"|").split("|"),function(a){return a}),h=0,i=0,k=[[]];for(var l in g)k[i][h]=g[l].replace(/[a-z|\.]/g,function(a){return"|"+a}).split("|"),h++,0==h%9&&(h=0,i++,l!=g.length-1&&(k[i]=[]));$("#HeaderCnCOptLink")[0].innerHTML="<a href=\""+a+"\" target=\"_blank\">CnCOpt ("+b+", Base "+c+")</a>",convertCncOptArrayToHtml(k,e)}function convertCncOptArrayToHtml(a,b){for(var c=["Build","Def","Off"],d=[8,8,4],e=0;3>e;e++){for(var f="",g=8*e,h=g;h<g+d[e];h++){f+="<tr>";for(var k=0;9>k;k++)f+="."==a[h][k][1]?"<td><div style=\"width: 30px; height: 30px;\"></div></td>":"h"!=a[h][k][1]&&"n"!=a[h][k][1]?"<td><img src=\"https://eaassets-a.akamaihd.net/cncalliancesgame/cdn/data/"+ObjectCncOptPics[b][c[e].toLowerCase()][a[h][k][1]]+".png\" width=\"30px\" height=\"30px\" title=\""+a[h][k][0]+"\"></td>":"<td><img src=\"img/game/faction_"+b+"/"+c[e].toLowerCase()+"/"+a[h][k][1]+".png\" width=\"30px\" height=\"30px\" title=\""+a[h][k][0]+"\"></td>";f+="</tr>"}$("#TableAllianceBase"+c[e]+"CnCOptTbody")[0].innerHTML=f}}function manageDownloadOfTable(a){var b=$("#DropDownListWorld")[0].value;switch(a.id){case"ButtonDownloadPlayerBaseData":{var c=$("#DropDownListPlayer")[0].value;alasql("SELECT * INTO XLSX('PlayerBaseData.xlsx',{headers:true}) FROM ? ",[ObjectPlayerBaseData[b+"_"+c]]);break}case"ButtonDownloadAlliancePlayerData":{var d=$("#DropDownListAlliance")[0].value;alasql("SELECT * INTO XLSX('AlliancePlayerData.xlsx',{headers:true}) FROM ? ",[ObjectAlliancePlayerData[b+"_"+d]]);break}default:}}function setCookie(a,b){document.cookie=a+"="+b+";"}function getCookie(a){for(var b,c="",d=a+"=",e=decodeURIComponent(document.cookie),f=e.split(";"),g=0;g<f.length;g++){for(b=f[g];" "==b.charAt(0);)b=b.substring(1);if(0==b.indexOf(d)){c=b.substring(d.length,b.length);break}}return c}