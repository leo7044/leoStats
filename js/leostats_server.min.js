/* Developer: leo7044 (https://github.com/leo7044) */
(function(){var e=function(){function e(){(function(){qx.Class.define("leoStats",{type:"singleton",extend:qx.core.Object,construct:function(){console.log("create leoStats...")},members:{initialize:function(){this.scriptVersionLocal="2020.02.02.2",this.scriptVersionServer="",this.newVersionAvailable=!1,this.sendChatInfoStatus=!0,this.ObjectData={},this.linkBase="",this.app=qx.core.Init.getApplication(),this.GuiButtonLeoStats=new qx.ui.form.Button("leoStats").set({center:!0,rich:!0}),this.checkForNewVersion(),this.setCncOptVars(),this.getCurrentStats(),this.buildGUI()},buildGUI:function(){this.GuiFenster=new qx.ui.window.Window("leoStats "+this.scriptVersionLocal+" by leo7044").set({padding:5,paddingRight:0,width:350,showMaximize:!1,showMinimize:!1,showClose:!0,allowClose:!0,resizable:!1}),this.GuiFenster.setTextColor("black"),this.GuiFenster.setLayout(new qx.ui.layout.HBox),this.GuiFenster.moveTo(850,32),this.GuiTab=new qx.ui.tabview.TabView().set({contentPaddingTop:3,contentPaddingBottom:6,contentPaddingRight:7,contentPaddingLeft:3}),this.GuiFenster.add(this.GuiTab),this.GuiInfoPage=new qx.ui.tabview.Page("Info"),this.GuiInfoPage.setLayout(new qx.ui.layout.VBox(5)),this.GuiTab.add(this.GuiInfoPage),this.GuiInfoVBox=new qx.ui.container.Composite,this.GuiInfoVBox.setLayout(new qx.ui.layout.VBox(5)),this.GuiInfoVBox.setThemedPadding(10),this.GuiInfoVBox.setThemedBackgroundColor("#eef"),this.GuiInfoPage.add(this.GuiInfoVBox),this.GuiButtonLeoStats.addListener("click",function(){this.newVersionAvailable?qx.core.Init.getApplication().showExternal("https://cnc.indyserver.info/js/leostats.min.user.js"):(this.GuiInfoVBox.removeAll(),this.showGui(),this.GuiFenster.show())},this),this.app.getDesktop().add(this.GuiButtonLeoStats,{right:125,top:0})},showGui:function(){this.getCurrentStats();var e=new qx.ui.container.Composite(new qx.ui.layout.HBox(50).set({alignX:"center"})),a=new qx.ui.container.Composite(new qx.ui.layout.VBox(1).set({alignX:"center"}));a.add(new qx.ui.basic.Label("<br><big><u><b>Information</b></u></big>").set({rich:!0})),a.add(new qx.ui.basic.Label("").set({rich:!0}));var t=new qx.ui.container.Composite(new qx.ui.layout.HBox(10).set({alignX:"center"})),n=new qx.ui.container.Composite(new qx.ui.layout.VBox(1).set({alignX:"right"})),r=new qx.ui.container.Composite(new qx.ui.layout.VBox(1).set({alignX:"left"}));n.add(new qx.ui.basic.Label("Scriptname").set({rich:!0})),r.add(new qx.ui.basic.Label("leoStats").set({rich:!0})),n.add(new qx.ui.basic.Label("Version").set({rich:!0})),r.add(new qx.ui.basic.Label(this.scriptVersionLocal).set({rich:!0})),n.add(new qx.ui.basic.Label("Autor").set({rich:!0})),r.add(new qx.ui.basic.Label("leo7044").set({rich:!0})),n.add(new qx.ui.basic.Label("Website").set({rich:!0})),r.add(new qx.ui.basic.Label("<a href=\"https://cnc.indyserver.info/\" target=\"_blank\">https://cnc.indyserver.info/</a>").set({rich:!0})),n.add(new qx.ui.basic.Label("BaseScanner").set({rich:!0})),r.add(new qx.ui.basic.Label("<a href=\"https://cnc.indyserver.info/BaseScanner/?WorldId="+this.ObjectData.server.WorldId+"\" target=\"_blank\">"+"https://cnc.indyserver.info/"+"BaseScanner/?WorldId="+this.ObjectData.server.WorldId+"</a>").set({rich:!0})),n.add(new qx.ui.basic.Label("E-Mail").set({rich:!0})),r.add(new qx.ui.basic.Label("<a href=\"mailto:cc.ta.leo7044@gmail.com\">cc.ta.leo7044@gmail.com</a>").set({rich:!0})),t.add(n),t.add(r),a.add(t),e.add(a),this.GuiInfoVBox.add(e)},checkForNewVersion:function(){var e=this;$.ajaxSetup({async:!1}),$.post("https://cnc.indyserver.info/php/manageBackend.php",{action:"getCurrentVersionOfLeoStats"}).always(function(a){e.scriptVersionServer=a[1]}),$.ajaxSetup({async:!0}),this.scriptVersionServer>this.scriptVersionLocal&&(this.newVersionAvailable=!0,this.GuiButtonLeoStats.setLabel("new version for leoStats, click here"))},setCncOptVars:function(){this.Defense_unit_map={GDI_Wall:"w",GDI_Cannon:"c","GDI_Antitank Barrier":"t",GDI_Barbwire:"b",GDI_Turret:"m",GDI_Flak:"f","GDI_Art Inf":"r","GDI_Art Air":"e","GDI_Art Tank":"a","GDI_Def_APC Guardian":"g","GDI_Def_Missile Squad":"q",GDI_Def_Pitbull:"p",GDI_Def_Predator:"d",GDI_Def_Sniper:"s","GDI_Def_Zone Trooper":"z","NOD_Def_Antitank Barrier":"t","NOD_Def_Art Air":"e","NOD_Def_Art Inf":"r","NOD_Def_Art Tank":"a","NOD_Def_Attack Bike":"p",NOD_Def_Barbwire:"b","NOD_Def_Black Hand":"z",NOD_Def_Cannon:"c",NOD_Def_Confessor:"s",NOD_Def_Flak:"f","NOD_Def_MG Nest":"m","NOD_Def_Militant Rocket Soldiers":"q",NOD_Def_Reckoner:"g","NOD_Def_Scorpion Tank":"d",NOD_Def_Wall:"w","":""},this.offense_unit_map={"GDI_APC Guardian":"g",GDI_Commando:"c",GDI_Firehawk:"f",GDI_Juggernaut:"j",GDI_Kodiak:"k",GDI_Mammoth:"m","GDI_Missile Squad":"q",GDI_Orca:"o",GDI_Paladin:"a",GDI_Pitbull:"p",GDI_Predator:"d",GDI_Riflemen:"r","GDI_Sniper Team":"s","GDI_Zone Trooper":"z","NOD_Attack Bike":"b",NOD_Avatar:"a","NOD_Black Hand":"z",NOD_Cobra:"r",NOD_Commando:"c",NOD_Confessor:"s","NOD_Militant Rocket Soldiers":"q",NOD_Militants:"m",NOD_Reckoner:"k",NOD_Salamander:"l","NOD_Scorpion Tank":"o","NOD_Specter Artilery":"p",NOD_Venom:"v",NOD_Vertigo:"t","":""}},findTechLayout:function(e){for(var a in e)if("object"==typeof e[a]&&e[a]&&0 in e[a]&&8 in e[a]&&"object"==typeof e[a][0]&&e[a][0]&&e[a][0]&&0 in e[a][0]&&15 in e[a][0]&&"object"==typeof e[a][0][0]&&e[a][0][0]&&"BuildingIndex"in e[a][0][0])return e[a];return null},findBuildings:function(e){var a=e.get_CityBuildingsData();for(var t in a)if(376877<=PerforceChangelist){if("object"==typeof a[t]&&a[t]&&"d"in a[t]&&"c"in a[t]&&0<a[t].c)return a[t].d;}else if("object"==typeof a[t]&&a[t]&&"l"in a[t])return a[t].l},isOffenseUnit:function(e){return e.get_UnitGameData_Obj().n in this.offense_unit_map},isDefenseUnit:function(e){return e.get_UnitGameData_Obj().n in this.Defense_unit_map},getUnitArrays:function(e){var a=[];for(var t in e)if("object"==typeof e[t]&&e[t])for(var n in e[t])if(376877<=PerforceChangelist){if("object"==typeof e[t][n]&&e[t][n]&&"d"in e[t][n]){var r=e[t][n].d;if("object"==typeof r&&r)for(var o in r)"object"==typeof r[o]&&r[o]&&"get_CurrentLevel"in r[o]&&a.push(r)}}else if("object"==typeof e[t][n]&&e[t][n]&&"l"in e[t][n]){var r=e[t][n].l;if("object"==typeof r&&r)for(var o in r)"object"==typeof r[o]&&r[o]&&"get_CurrentLevel"in r[o]&&a.push(r)}return a},getDefenseUnits:function(e){for(var a=this.getUnitArrays(e),t=0;t<a.length;++t)for(var n in a[t])if(this.isDefenseUnit(a[t][n]))return a[t];return[]},getOffenseUnits:function(e){for(var a=this.getUnitArrays(e),t=0;t<a.length;++t)for(var n in a[t])if(this.isOffenseUnit(a[t][n]))return a[t];return[]},CnCOpt:function(e,a,t){var n=this,r={keymap:{GDI_Accumulator:"a",GDI_Refinery:"r","GDI_Trade Center":"u",GDI_Silo:"s","GDI_Power Plant":"p","GDI_Construction Yard":"y",GDI_Airport:"d",GDI_Barracks:"b",GDI_Factory:"f","GDI_Defense HQ":"q","GDI_Defense Facility":"w","GDI_Command Center":"e",GDI_Support_Art:"z",GDI_Support_Air:"x",GDI_Support_Ion:"i",FOR_Silo:"s",FOR_Refinery:"r","FOR_Tiberium Booster":"b","FOR_Crystal Booster":"v","FOR_Trade Center":"u","FOR_Defense Facility":"w","FOR_Construction Yard":"y","FOR_EVENT_Construction Yard":"y",FOR_Harvester_Tiberium:"h","FOR_Defense HQ":"q",FOR_Harvester_Crystal:"n",NOD_Refinery:"r","NOD_Power Plant":"p",NOD_Harvester:"h","NOD_Construction Yard":"y",NOD_Airport:"d","NOD_Trade Center":"u","NOD_Defense HQ":"q",NOD_Barracks:"b",NOD_Silo:"s",NOD_Factory:"f",NOD_Harvester_Crystal:"n","NOD_Command Post":"e",NOD_Support_Art:"z",NOD_Support_Ion:"i",NOD_Accumulator:"a",NOD_Support_Air:"x","NOD_Defense Facility":"w",GDI_Wall:"w",GDI_Cannon:"c","GDI_Antitank Barrier":"t",GDI_Barbwire:"b",GDI_Turret:"m",GDI_Flak:"f","GDI_Art Inf":"r","GDI_Art Air":"e","GDI_Art Tank":"a","GDI_Def_APC Guardian":"g","GDI_Def_Missile Squad":"q",GDI_Def_Pitbull:"p",GDI_Def_Predator:"d",GDI_Def_Sniper:"s","GDI_Def_Zone Trooper":"z","NOD_Def_Antitank Barrier":"t","NOD_Def_Art Air":"e","NOD_Def_Art Inf":"r","NOD_Def_Art Tank":"a","NOD_Def_Attack Bike":"p",NOD_Def_Barbwire:"b","NOD_Def_Black Hand":"z",NOD_Def_Cannon:"c",NOD_Def_Confessor:"s",NOD_Def_Flak:"f","NOD_Def_MG Nest":"m","NOD_Def_Militant Rocket Soldiers":"q",NOD_Def_Reckoner:"g","NOD_Def_Scorpion Tank":"d",NOD_Def_Wall:"w","GDI_APC Guardian":"g",GDI_Commando:"c",GDI_Firehawk:"f",GDI_Juggernaut:"j",GDI_Kodiak:"k",GDI_Mammoth:"m","GDI_Missile Squad":"q",GDI_Orca:"o",GDI_Paladin:"a",GDI_Pitbull:"p",GDI_Predator:"d",GDI_Riflemen:"r","GDI_Sniper Team":"s","GDI_Zone Trooper":"z","NOD_Attack Bike":"b",NOD_Avatar:"a","NOD_Black Hand":"z",NOD_Cobra:"r",NOD_Commando:"c",NOD_Confessor:"s","NOD_Militant Rocket Soldiers":"q",NOD_Militants:"m",NOD_Reckoner:"k",NOD_Salamander:"l","NOD_Scorpion Tank":"o","NOD_Specter Artilery":"p",NOD_Venom:"v",NOD_Vertigo:"t","<last>":"."},make_sharelink:function(e,a,t){try{var o=ClientLib.Data.MainData.GetInstance().get_Cities().GetCity(e),s=ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentOwnCity(),c=ClientLib.Data.MainData.GetInstance().get_Alliance(),l=ClientLib.Data.MainData.GetInstance().get_Server(),D="http://cncopt.com/?map=3|";1===t?D+="G|G|":2===t?D+="N|N|":void 0;D+=a+"|";for(var u,_=[],g=0;20>g;++g){u=[];for(var d=0;9>d;++d)u.push(null);_.push(u)}var y=n.getDefenseUnits(o);if(376877<=PerforceChangelist)for(var g in y){var p=y[g];_[p.get_CoordX()][p.get_CoordY()+8]=p}else for(var p,g=0;g<y.length;++g)p=y[g],_[p.get_CoordX()][p.get_CoordY()+8]=p;for(var u,I=[],g=0;20>g;++g){u=[];for(var d=0;9>d;++d)u.push(null);I.push(u)}if(1==o.get_CityFaction()||2==o.get_CityFaction())var O=n.getOffenseUnits(o);else var O=n.getOffenseUnits(s);if(376877<=PerforceChangelist)for(var g in O){var p=O[g];I[p.get_CoordX()][p.get_CoordY()+16]=p}else for(var p,g=0;g<O.length;++g)p=O[g],I[p.get_CoordX()][p.get_CoordY()+16]=p;for(var G=n.findTechLayout(o),b=n.findBuildings(o),g=0;20>g;++g)for(var d=0;9>d;++d){var f=16<g?null:G[d][g],C=0,m=null;f&&0<=f.BuildingIndex&&(m=b[f.BuildingIndex],C=m.get_CurrentLevel());var S=_[d][g];S&&(C=S.get_CurrentLevel());var B=I[d][g];switch(B&&(C=B.get_CurrentLevel()),1<C&&(D+=C),16<g?0:o.GetResourceType(d,g)){case 0:if(m){var A=m.get_MdbBuildingId();GAMEDATA.Tech[A].n in r.keymap?D+=r.keymap[GAMEDATA.Tech[A].n]:(console.log("cncopt [5]: Unhandled building: "+A,m),D+=".")}else S?S.get_UnitGameData_Obj().n in r.keymap?D+=r.keymap[S.get_UnitGameData_Obj().n]:(console.log("cncopt [5]: Unhandled unit: "+S.get_UnitGameData_Obj().n),D+="."):B?B.get_UnitGameData_Obj().n in r.keymap?D+=r.keymap[B.get_UnitGameData_Obj().n]:(console.log("cncopt [5]: Unhandled unit: "+B.get_UnitGameData_Obj().n),D+="."):D+=".";break;case 1:D+=0>f.BuildingIndex?"c":"n";break;case 2:D+=0>f.BuildingIndex?"t":"h";break;case 4:D+="j";break;case 5:D+="h";break;case 6:D+="l";break;case 7:D+="k";break;Default:console.log("cncopt [4]: Unhandled resource type: "+o.GetResourceType(d,g));D+=".";}}c&&s.get_AllianceId()==o.get_AllianceId()&&(D+="|"+c.get_POITiberiumBonus(),D+="|"+c.get_POICrystalBonus(),D+="|"+c.get_POIPowerBonus(),D+="|"+c.get_POIInfantryBonus(),D+="|"+c.get_POIVehicleBonus(),D+="|"+c.get_POIAirBonus(),D+="|"+c.get_POIDefenseBonus()),1.2!=l.get_TechLevelUpgradeFactorBonusAmount()&&(D+="|newEconomy"),n.linkBase=D}catch(a){console.log("cncopt [1]: ",a)}}};r.make_sharelink(e,a,t)},getCurrentStats:function(){try{var e=ClientLib.Data.MainData.GetInstance().get_Alliance().get_Id();if(0<e){this.ObjectData.server={},this.ObjectData.alliance={},this.ObjectData.player={},this.ObjectData.bases=[],this.ObjectData.substitution={},this.ObjectData.substitution.incoming=[],this.ObjectData.substitution.outgoing="",this.ObjectData.substitution.active=[];var a=ClientLib.Data.MainData.GetInstance().get_Server().get_WorldId(),t=ClientLib.Data.MainData.GetInstance().get_Server().get_Name().trim(),n=ClientLib.Data.MainData.GetInstance().get_Server().get_IsSeasonServer(),r=ClientLib.Data.MainData.GetInstance().get_Alliance().get_Name(),o=ClientLib.Data.MainData.GetInstance().get_Alliance().get_Rank(),s=ClientLib.Data.MainData.GetInstance().get_Alliance().get_EventRank(),c=ClientLib.Data.MainData.GetInstance().get_Alliance().get_TotalScore(),l=ClientLib.Data.MainData.GetInstance().get_Alliance().get_AverageScore(),D=ClientLib.Data.MainData.GetInstance().get_Alliance().get_EventScore(),u=0;try{for(Le=0;Le<ClientLib.Data.MainData.GetInstance().get_Alliance().get_OwnShieldHubs().length;Le++)u+=ClientLib.Data.MainData.GetInstance().get_Server().GetControlHubVeteranPointsProduction(ClientLib.Data.MainData.GetInstance().get_Alliance().get_OwnShieldHubs()[Le].l)}catch(a){}var _=ClientLib.Data.MainData.GetInstance().get_Alliance().GetPOIBonusFromResourceType(ClientLib.Base.EResourceType.Tiberium),g=ClientLib.Data.MainData.GetInstance().get_Alliance().GetPOIBonusFromResourceType(ClientLib.Base.EResourceType.Crystal),d=ClientLib.Data.MainData.GetInstance().get_Alliance().GetPOIBonusFromResourceType(ClientLib.Base.EResourceType.Power),y=ClientLib.Data.MainData.GetInstance().get_Alliance().get_POIInfantryBonus(),p=ClientLib.Data.MainData.GetInstance().get_Alliance().get_POIVehicleBonus(),I=ClientLib.Data.MainData.GetInstance().get_Alliance().get_POIAirBonus(),O=ClientLib.Data.MainData.GetInstance().get_Alliance().get_POIDefenseBonus(),G=ClientLib.Data.MainData.GetInstance().get_Alliance().get_POIRankScore(),b=G[0].r,f=G[1].r,C=G[2].r,m=G[3].r,S=G[4].r,B=G[5].r,A=G[6].r,P=G[0].s,k=G[1].s,h=G[2].s,j=G[3].s,N=G[4].s,R=G[5].s,v=G[6].s,M=ClientLib.Data.MainData.GetInstance().get_Player().get_AccountId(),L=ClientLib.Data.MainData.GetInstance().get_Player().get_Name(),T=ClientLib.Data.MainData.GetInstance().get_Player().get_ScorePoints(),F=ClientLib.Data.MainData.GetInstance().get_Player().get_OverallRank(),x=ClientLib.Data.MainData.GetInstance().get_Player().get_EventRank(),w=ClientLib.Data.MainData.GetInstance().get_Player().get_EventScore(),E=ClientLib.Data.MainData.GetInstance().get_Player().get_ResearchPoints(),V=ClientLib.Data.MainData.GetInstance().get_Player().get_Credits().Base,H=ClientLib.Data.MainData.GetInstance().get_Inventory().get_PlayerFunds(),U=ClientLib.Data.MainData.GetInstance().get_Player().get_LegacyPoints(),z=ClientLib.Data.MainData.GetInstance().get_Player().GetCommandPointMaxStorage(),W=ClientLib.Data.MainData.GetInstance().get_Player().GetCommandPointCount(),q=ClientLib.Data.MainData.GetInstance().get_Player().get_Faction(),Y=ClientLib.Data.MainData.GetInstance().get_Alliance().get_CurrentMemberRoleInfo().SortOrder,X=ClientLib.Data.MainData.GetInstance().get_Cities().get_AllCities().d,Z=ClientLib.Data.MainData.GetInstance().get_Cities().get_AllCities().c,Q=0,J=0,K=0,ee=0,ae=0,te=0,ne=0,re=0,ie=0,oe=0,se=0,ce=0,le=0;for(var De in X){var ue=X[De],_e=0,ge=ue.get_Id(),de=ue.get_Name(),ye=ue.get_ConstructionYardLevel(),pe=ue.get_LvlBase(),Ie=ue.get_LvlOffense(),Oe=ue.get_LvlDefense();ue.GetResourceMaxStorage(ClientLib.Base.EResourceType.RepairChargeInf)>le&&(le=ue.GetResourceMaxStorage(ClientLib.Base.EResourceType.RepairChargeInf));var Ge=ue.GetResourceCount(ClientLib.Base.EResourceType.RepairChargeInf),be=ue.get_CityBuildingsData(),fe=be.GetUniqueBuildingByTechName(ClientLib.Base.ETechName.Defense_Facility);null!==fe&&(_e=fe.get_CurrentLevel(),te+=fe.get_CurrentLevel()),Q+=ue.get_LvlBase(),J+=ue.get_LvlOffense(),K+=ue.get_LvlDefense(),ue.get_LvlOffense()>ee&&(ee=ue.get_LvlOffense()),ue.get_LvlDefense()>ae&&(ae=ue.get_LvlDefense());var Ce=0,me="";null!==ue.get_SupportData()&&(Ce=ue.get_SupportData().get_Level(),me=ue.get_SupportWeapon().n.replace(/NOD_SUPPORT_/gi,"").replace(/GDI_SUPPORT_/gi,"").replace(/FOR_SUPPORT_/gi,""),ne+=ue.get_SupportData().get_Level(),re++);var Se=parseInt(ue.GetResourceGrowPerHour(ClientLib.Base.EResourceType.Tiberium,!1,!1)+ue.GetResourceBonusGrowPerHour(ClientLib.Base.EResourceType.Tiberium)+ClientLib.Data.MainData.GetInstance().get_Alliance().GetPOIBonusFromResourceType(ClientLib.Base.EResourceType.Tiberium)),Be=parseInt(ue.GetResourceGrowPerHour(ClientLib.Base.EResourceType.Crystal,!1,!1)+ue.GetResourceBonusGrowPerHour(ClientLib.Base.EResourceType.Crystal)+ClientLib.Data.MainData.GetInstance().get_Alliance().GetPOIBonusFromResourceType(ClientLib.Base.EResourceType.Crystal)),Ae=parseInt(ue.GetResourceGrowPerHour(ClientLib.Base.EResourceType.Power,!1,!1)+ue.GetResourceBonusGrowPerHour(ClientLib.Base.EResourceType.Power)+ClientLib.Data.MainData.GetInstance().get_Alliance().GetPOIBonusFromResourceType(ClientLib.Base.EResourceType.Power)),Pe=parseInt(ClientLib.Base.Resource.GetResourceGrowPerHour(ue.get_CityCreditsProduction(),!1)+ClientLib.Base.Resource.GetResourceBonusGrowPerHour(ue.get_CityCreditsProduction(),!1));ie+=Se,oe+=Be,se+=Ae,ce+=Pe;var ke={};ke.BaseId=ge,ke.Name=de,ke.LvLCY=ye,ke.LvLBase=pe,ke.LvLOffense=Ie,ke.LvLDefense=Oe,ke.LvLDF=_e,ke.LvLSupport=Ce,ke.SupArt=me,ke.TiberiumPerHour=Se,ke.CrystalPerHour=Be,ke.PowerPerHour=Ae,ke.CreditsPerHour=Pe,ke.CurrentRepairTime=Ge,this.CnCOpt(ge,de,q),ke.CnCOpt=this.linkBase,this.ObjectData.bases.push(ke),this.linkBase=""}var he=Q/Z,je=J/Z,Ne=K/Z,Re=te/Z,ve=ne/Z;this.ObjectData.server.WorldId=a,this.ObjectData.server.ServerName=t,this.ObjectData.server.SeasonServer=n,this.ObjectData.alliance.AllianceId=e,this.ObjectData.alliance.AllianceName=r,this.ObjectData.alliance.AllianceRank=o,this.ObjectData.alliance.AllianceEventRank=s,this.ObjectData.alliance.AllianceTotalScore=c,this.ObjectData.alliance.AllianceAverageScore=l,this.ObjectData.alliance.AllianceVeteranPoints=D,this.ObjectData.alliance.AllianceProdVetPoints=u,this.ObjectData.alliance.BonusTiberium=_,this.ObjectData.alliance.BonusCrystal=g,this.ObjectData.alliance.BonusPower=d,this.ObjectData.alliance.BonusInfantrie=y,this.ObjectData.alliance.BonusVehicle=p,this.ObjectData.alliance.BonusAir=I,this.ObjectData.alliance.BonusDef=O,this.ObjectData.alliance.RankTib=b,this.ObjectData.alliance.RankCry=f,this.ObjectData.alliance.RankPow=C,this.ObjectData.alliance.RankInf=m,this.ObjectData.alliance.RankVeh=S,this.ObjectData.alliance.RankAir=B,this.ObjectData.alliance.RankDef=A,this.ObjectData.alliance.ScoreTib=P,this.ObjectData.alliance.ScoreCry=k,this.ObjectData.alliance.ScorePow=h,this.ObjectData.alliance.ScoreInf=j,this.ObjectData.alliance.ScoreVeh=N,this.ObjectData.alliance.ScoreAir=R,this.ObjectData.alliance.ScoreDef=v,this.ObjectData.player.AccountId=M,this.ObjectData.player.PlayerName=L,this.ObjectData.player.PlayerScorePoints=T,this.ObjectData.player.CountBases=Z,this.ObjectData.player.CountSup=re,this.ObjectData.player.PlayerRank=F,this.ObjectData.player.PlayerEventRank=x,this.ObjectData.player.PlayerVeteranPoints=w,this.ObjectData.player.ResearchPoints=E,this.ObjectData.player.Credits=V,this.ObjectData.player.Funds=H,this.ObjectData.player.LegacyPoints=U,this.ObjectData.player.CommandPointsMaxStorage=z,this.ObjectData.player.CommandPointsCurrent=W,this.ObjectData.player.Faction=q,this.ObjectData.player.MemberRole=Y,this.ObjectData.player.LvLHighestOff=ee,this.ObjectData.player.LvLHighestDef=ae,this.ObjectData.player.AverageBase=he,this.ObjectData.player.AverageOff=je,this.ObjectData.player.AverageDef=Ne,this.ObjectData.player.AverageDF=Re,this.ObjectData.player.AverageSup=ve,this.ObjectData.player.ProductionTiberium=ie,this.ObjectData.player.ProductionCrystal=oe,this.ObjectData.player.ProductionPower=se,this.ObjectData.player.ProductionCredits=ce,this.ObjectData.player.MaxRepairTime=le,ClientLib.Data.MainData.GetInstance().get_PlayerSubstitution().getOutgoing()&&(this.ObjectData.substitution.outgoing=ClientLib.Data.MainData.GetInstance().get_PlayerSubstitution().getOutgoing().n);for(var Me=ClientLib.Data.MainData.GetInstance().get_PlayerSubstitution().getIncoming(),Le=0;Le<Me.length;Le++)this.ObjectData.substitution.incoming.push(Me[Le].n);for(var Te=ClientLib.Data.MainData.GetInstance().get_PlayerSubstitution().getSubstitution(),Le=0;Le<Te.length;Le++)this.ObjectData.substitution.active.push(Te[Le].n);var Fe=this;ClientLib.Net.CommunicationManager.GetInstance().SendSimpleCommand("GetPublicPlayerInfoByName",{name:L},phe.cnc.Util.createEventDelegate(ClientLib.Net.CommandResult,this,Fe.getPublicPlayerInfoByName),null),this.sendDataFromInGame();var Fe=this;setTimeout(function(){Fe.getCurrentStats()},36e5)}else{var Fe=this;setTimeout(function(){Fe.getCurrentStats()},1e3)}}catch(a){console.log(a)}},getPublicPlayerInfoByName:function(e,a){for(var t=a.c,n=0;n<t.length;n++)this.ObjectData.bases[n].ScorePoints=t[n].p;this.ObjectData.player.Shoot=a.bd,this.ObjectData.player.PvP=a.bd-a.bde,this.ObjectData.player.PvE=a.bde},sendChatInfo:function(e){var a="";a=0!=e[0]||ClientLib.Data.MainData.GetInstance().get_Player().get_IsSubstituted()?"/w "+this.ObjectData.player.PlayerName+" Hallo "+this.ObjectData.player.PlayerName+", um zu leoStats zu gelangen, klicke auf [url]https://cnc.indyserver.info/[/url].":"/w "+this.ObjectData.player.PlayerName+" Hallo "+this.ObjectData.player.PlayerName+", um zu leoStats zu gelangen, klicke auf [url]https://cnc.indyserver.info/[/url]. Dein Benutzername ist \""+this.ObjectData.player.PlayerName+"\" und dein Standardpasswort: \""+this.ObjectData.player.PlayerName+"_"+this.ObjectData.player.AccountId+"\"",qx.core.Init.getApplication().getChat().getChatWidget().send(a)},sendDataFromInGame:function(){if(this.ObjectData!=null&&this.ObjectData.player!=null&&this.ObjectData.player.Shoot!=null){var e={action:"sendDataFromInGame",ObjectData:this.ObjectData},a=this;$.post("https://cnc.indyserver.info/php/manageBackend.php",e).always(function(e){a.sendChatInfoStatus&&(a.sendChatInfo(e),a.sendChatInfoStatus=!1)})}else{var a=this;setTimeout(function(){a.sendDataFromInGame()},1e3)}}}}),leoStats.getInstance().initialize(),qx.Class.define("BaseScanner",{type:"singleton",extend:qx.core.Object,construct:function(){console.log("create BaseScanner...")},members:{initialize:function(){this.app=qx.core.Init.getApplication(),this.ArrayLayouts=[],this.ArrayScannedIds=[],this.ScriptIsRunning=!1,this.buildGUI();var e=ClientLib.Data.MainData.GetInstance().get_Server().get_WorldId(),a=ClientLib.Data.MainData.GetInstance().get_Player().get_Name();320!=e&&"leo7044"!=a&&this.autoScanByClickOnBase()},buildGUI:function(){this.GuiButtonBaseScanner=new qx.ui.form.Button("Start BaseScanner...").set({center:!0,rich:!0}),this.GuiButtonBaseScanner.addListener("click",function(){this.ScriptIsRunning?this.stopBaseScan():this.startBaseScan()},this),this.app.getDesktop().add(this.GuiButtonBaseScanner,{right:125,top:24})},autoScanByClickOnBase:function(){this.initializeDefaultValues();var e=this;phe.cnc.Util.attachNetEvent(ClientLib.Data.MainData.GetInstance().get_Cities(),"CurrentChange",ClientLib.Data.CurrentCityChange,this,e.scanClickedBase)},scanClickedBase:function(e,a){if(!this.ScriptIsRunning&&ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentCity()){var t=ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentCity().get_CityFaction();(4==t||5==t||6==t||8==t)&&-1==this.ArrayScannedIds.indexOf(a)&&-1==this.ArrayIdsForScan.indexOf(a)?(this.errorRangeCounter=0,"undefined"!=typeof timeoutScanClickedBase&&clearTimeout(timeoutScanClickedBase),this.ArrayIdsForScan=[],this.ArrayIdsForScan.push(a),this.scanFirstLayout()):0==t&&5>this.errorRangeCounter?(this.errorRangeCounter++,_self=this,timeoutScanClickedBase=setTimeout(function(){_self.scanClickedBase(e,a)},1e3)):("undefined"!=typeof timeoutScanClickedBase&&clearTimeout(timeoutScanClickedBase),this.errorRangeCounter=0)}},startBaseScan:function(){this.ScriptIsRunning=!0,this.GuiButtonBaseScanner.setLabel("Stop BaseScanner..."),this.startScan()},stopBaseScan:function(){this.ScriptIsRunning=!1,this.GuiButtonBaseScanner.setLabel("Start BaseScanner..."),this.stopScan()},initializeDefaultValues:function(){this.attRange=ClientLib.Data.MainData.GetInstance().get_Server().get_MaxAttackDistance(),this.ArrayPrototypeGameObjectType2=[],this.ArrayPrototypeGameObjectType3=[],this.ArrayIdsForScan=[],this.errorExistsCounter=0,this.errorRangeCounter=0},getArrayPrototypeGameObject:function(){var e=ClientLib.Data.MainData.GetInstance().get_Cities().get_AllCities().d;for(var a in e){for(var t=e[a].get_X(),n=e[a].get_Y(),r=0,i=0,o=0,s=0,c=t-10;c<t+10;c++){for(var l,D=n-10;D<n+10;D++)if(l=ClientLib.Data.MainData.GetInstance().get_World().GetObjectFromPosition(c,D),null!=l)if(2==l.Type&&!r&&!i)r=c,i=D;else if(3==l.Type&&!o&&!s)o=c,s=D;else if(r&&i&&o&&s)break;if(r&&i&&o&&s)break}if(r&&i&&o&&s)break}for(var a in ClientLib.Data.MainData.GetInstance().get_World().GetObjectFromPosition(r,i))this.ArrayPrototypeGameObjectType2.push(a);for(var a in ClientLib.Data.MainData.GetInstance().get_World().GetObjectFromPosition(o,s))this.ArrayPrototypeGameObjectType3.push(a)},returnLayoutOfCurBaseAndEvaluateIt:function(){for(var e=Array(8).fill().map(()=>Array(9).fill()),a=ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentCity(),t=0;8>t;t++)for(var n=0;9>n;n++)a.GetResourceType(n,t)&&(e[t][n]=a.GetResourceType(n,t));for(var r=a.get_X(),i=a.get_Y(),o=0,s=0,c=0,l=0,D=0,u=0,_=0,g=0,d=0,p=0,I=0,O=0,G=0,b=0,f=0,C=0,m=0,S=0,B=0,A=0,P=0,k=0,h=0,j=0,N=0,t=0;8>t;t++)for(var n=0;9>n;n++)if(null==e[t][n]){var R=0,v=0,M=0,L=0;switch(0==n&&0==t?(1==e[t][n+1]?(v++,M++):2==e[t][n+1]?(R++,M++):L++,1==e[t+1][n+1]?(v++,M++):2==e[t+1][n+1]?(R++,M++):L++,1==e[t+1][n]?(v++,M++):2==e[t+1][n]?(R++,M++):L++):8==n&&0==t?(1==e[t][n-1]?(v++,M++):2==e[t][n-1]?(R++,M++):L++,1==e[t+1][n-1]?(v++,M++):2==e[t+1][n-1]?(R++,M++):L++,1==e[t+1][n]?(v++,M++):2==e[t+1][n]?(R++,M++):L++):0==t?(1==e[t][n-1]?(v++,M++):2==e[t][n-1]?(R++,M++):L++,1==e[t+1][n-1]?(v++,M++):2==e[t+1][n-1]?(R++,M++):L++,1==e[t+1][n]?(v++,M++):2==e[t+1][n]?(R++,M++):L++,1==e[t+1][n+1]?(v++,M++):2==e[t+1][n+1]?(R++,M++):L++,1==e[t][n+1]?(v++,M++):2==e[t][n+1]?(R++,M++):L++):0==n&&7==t?(1==e[t-1][n]?(v++,M++):2==e[t-1][n]?(R++,M++):L++,1==e[t-1][n+1]?(v++,M++):2==e[t-1][n+1]?(R++,M++):L++,1==e[t][n+1]?(v++,M++):2==e[t][n+1]?(R++,M++):L++):0==n?(1==e[t-1][n]?(v++,M++):2==e[t-1][n]?(R++,M++):L++,1==e[t-1][n+1]?(v++,M++):2==e[t-1][n+1]?(R++,M++):L++,1==e[t][n+1]?(v++,M++):2==e[t][n+1]?(R++,M++):L++,1==e[t+1][n+1]?(v++,M++):2==e[t+1][n+1]?(R++,M++):L++,1==e[t+1][n]?(v++,M++):2==e[t+1][n]?(R++,M++):L++):8==n&&7==t?(1==e[t][n-1]?(v++,M++):2==e[t][n-1]?(R++,M++):L++,1==e[t-1][n-1]?(v++,M++):2==e[t-1][n-1]?(R++,M++):L++,1==e[t-1][n]?(v++,M++):2==e[t-1][n]?(R++,M++):L++):7==t?(1==e[t][n-1]?(v++,M++):2==e[t][n-1]?(R++,M++):L++,1==e[t-1][n-1]?(v++,M++):2==e[t-1][n-1]?(R++,M++):L++,1==e[t-1][n]?(v++,M++):2==e[t-1][n]?(R++,M++):L++,1==e[t-1][n+1]?(v++,M++):2==e[t-1][n+1]?(R++,M++):L++,1==e[t][n+1]?(v++,M++):2==e[t][n+1]?(R++,M++):L++):8==n?(1==e[t-1][n]?(v++,M++):2==e[t-1][n]?(R++,M++):L++,1==e[t-1][n-1]?(v++,M++):2==e[t-1][n-1]?(R++,M++):L++,1==e[t][n-1]?(v++,M++):2==e[t][n-1]?(R++,M++):L++,1==e[t+1][n-1]?(v++,M++):2==e[t+1][n-1]?(R++,M++):L++,1==e[t+1][n]?(v++,M++):2==e[t+1][n]?(R++,M++):L++):(1==e[t-1][n]?(v++,M++):2==e[t-1][n]?(R++,M++):L++,1==e[t-1][n+1]?(v++,M++):2==e[t-1][n+1]?(R++,M++):L++,1==e[t][n+1]?(v++,M++):2==e[t][n+1]?(R++,M++):L++,1==e[t+1][n+1]?(v++,M++):2==e[t+1][n+1]?(R++,M++):L++,1==e[t+1][n]?(v++,M++):2==e[t+1][n]?(R++,M++):L++,1==e[t+1][n-1]?(v++,M++):2==e[t+1][n-1]?(R++,M++):L++,1==e[t][n-1]?(v++,M++):2==e[t][n-1]?(R++,M++):L++,1==e[t-1][n-1]?(v++,M++):2==e[t-1][n-1]?(R++,M++):L++),R){case 6:{o++;break}case 5:{s++;break}case 4:{c++;break}case 3:{l++;break}case 2:{D++;break}case 1:{u++;break}default:}switch(v){case 6:{_++;break}case 5:{g++;break}case 4:{d++;break}case 3:{p++;break}case 2:{I++;break}case 1:{O++;break}default:}switch(M){case 6:{G++;break}case 5:{b++;break}case 4:{f++;break}case 3:{C++;break}case 2:{m++;break}case 1:{S++;break}default:}switch(L){case 8:{B++;break}case 7:{A++;break}case 6:{P++;break}case 5:{k++;break}case 4:{h++;break}case 3:{j++;break}case 2:{N++;break}default:}}return{Zeit:Date.now(),PosX:r,PosY:i,Layout:JSON.stringify(e),EvaluatedFields:[o,s,c,l,D,u,_,g,d,p,I,O,G,b,f,C,m,S,B,A,P,k,h,j,N]}},scanFirstLayout:function(){for(var e in this.ArrayIdsForScan){var a=this.ArrayIdsForScan[e];this.ScriptIsRunning&&ClientLib.Data.MainData.GetInstance().get_Cities().set_CurrentCityId(a);var t=this;setTimeout(function(){if(!ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentCity())5>t.errorExistsCounter?t.errorExistsCounter+=1:(console.log("Layout not found ("+t.errorExistsCounter+"), removing it from scan"),t.ArrayIdsForScan.splice(0,1),t.errorExistsCounter=0,t.scanFirstLayout());else if(ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentCity().get_Buildings().c&&0>ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentCity().get_OwnerId()){t.errorExistsCounter=0,t.ArrayLayouts.push(t.returnLayoutOfCurBaseAndEvaluateIt()),t.ScriptIsRunning?t.ArrayScannedIds.push(a):t.ArrayScannedIds.push(ClientLib.Data.MainData.GetInstance().get_Cities().get_CurrentCityId()),t.ArrayIdsForScan.splice(0,1),console.log(t.ArrayLayouts.length+" / "+t.ArrayIdsForScan.length);var e=t.ArrayLayouts.length+t.ArrayIdsForScan.length;t.GuiButtonBaseScanner.setLabel("Scan Base... ("+t.ArrayLayouts.length+" / "+e+")"),t.scanFirstLayout()}else 5>t.errorExistsCounter?(t.errorExistsCounter++,console.log("Layout not found ("+t.errorExistsCounter+")"),t.scanFirstLayout()):(console.log("Layout not found ("+t.errorExistsCounter+"), removing it from scan"),t.ArrayIdsForScan.splice(0,1),t.errorExistsCounter=0,t.scanFirstLayout())},1e3);break}if(!this.ArrayIdsForScan.length){this.sendData();var t=this;setTimeout(function(){t.stopBaseScan()},1e3)}},scanAroundOwnBase:function(e){for(var a=ClientLib.Data.MainData.GetInstance().get_Cities().get_AllCities().d[e].get_PosX(),t=ClientLib.Data.MainData.GetInstance().get_Cities().get_AllCities().d[e].get_PosY(),n=parseInt(a-this.attRange);n<=parseInt(a+this.attRange);n++)for(var r,o=parseInt(t-this.attRange);o<=parseInt(t+this.attRange);o++)if(r=Math.sqrt(Math.pow(n-a,2)+Math.pow(o-t,2)),r<=this.attRange){var s=ClientLib.Data.MainData.GetInstance().get_World().GetObjectFromPosition(n,o);if(s)if(3==s.Type&&(0<s[this.ArrayPrototypeGameObjectType3[10]]||0<s[this.ArrayPrototypeGameObjectType3[11]])){var c=s[this.ArrayPrototypeGameObjectType3[12]];-1==this.ArrayIdsForScan.indexOf(c)&&-1==this.ArrayScannedIds.indexOf(c)&&this.ArrayIdsForScan.push(c)}else if(2==s.Type){var c=s[this.ArrayPrototypeGameObjectType2[12]];-1==this.ArrayIdsForScan.indexOf(c)&&-1==this.ArrayScannedIds.indexOf(c)&&this.ArrayIdsForScan.push(c)}}},iterateThroughOwnBases:function(){var e=ClientLib.Data.MainData.GetInstance().get_Cities().get_AllCities().d;for(var a in e){var t=e[a],n=t.get_Id();this.scanAroundOwnBase(n)}},sendData:function(){for(var e,a=ClientLib.Data.MainData.GetInstance().get_Server().get_WorldId(),t=ClientLib.Data.MainData.GetInstance().get_Player().get_Name(),n=30,r=0;r<Math.ceil(this.ArrayLayouts.length/n);r++){if(e=[],r==Math.ceil(this.ArrayLayouts.length/n)-1)for(var i=r*n;i<this.ArrayLayouts.length;i++)e.push(this.ArrayLayouts[i]);else for(var i=r*n;i<(r+1)*n;i++)e.push(this.ArrayLayouts[i]);var o={action:"sendDataFromInGameBaseScanner",ObjectData:e,WorldId:a,PlayerName:t};$.post("https://cnc.indyserver.info/php/manageBackend.php",o).always(function(e){console.log(e)})}},stopScan:function(){this.initializeDefaultValues()},startScan:function(){console.log("Start..."),this.initializeDefaultValues(),this.getArrayPrototypeGameObject(),this.iterateThroughOwnBases(),this.scanFirstLayout()}}}),BaseScanner.getInstance().initialize()})()}function a(){try{if("undefined"!=typeof qx&&!!qx.core.Init.getApplication().getMenuBar())return void e()}catch(a){console===void 0?window.opera?opera.postError(a):GM_log(a):console.log(a)}setTimeout(a,1e3)}a()};(function(){var a=document.createElement("script");a.innerHTML="("+e.toString()+")();",a.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(a)})()})();